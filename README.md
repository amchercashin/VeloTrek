# VeloTrek

Мобильное PWA-приложение для офлайн велонавигации по KML/KMZ маршрутам.

**[Открыть приложение](https://amchercashin.github.io/VeloTrek/)**

## Возможности

- **Каталог маршрутов** — список с названиями, расстояниями и статистикой
- **Интерактивная карта** — Leaflet + OpenStreetMap, маршрут с точками интереса
- **Офлайн-карта** — скачивание тайлов в память устройства (IndexedDB), работает без интернета
- **GPS-навигация** — текущая позиция на карте, скорость, расстояние до маршрута, экран не гаснет
- **PWA** — устанавливается на домашний экран телефона как обычное приложение

## Технологии

Чистый HTML/CSS/JS, без сборки и зависимостей. Хостинг — GitHub Pages.

| Библиотека | Назначение |
|---|---|
| [Leaflet](https://leafletjs.com/) | Карта |
| [JSZip](https://stuk.github.io/jszip/) | Распаковка KMZ |
| [idb](https://github.com/nicolo-ribaudo/idb) | Обёртка IndexedDB для тайлов |

## Как это работает

1. Маршруты хранятся в папке `routes/` в формате KML или KMZ
2. GitHub Action автоматически генерирует `routes/index.json` (каталог) при каждом пуше
3. Приложение загружает каталог и показывает список маршрутов
4. Пользователь открывает маршрут, скачивает карту для офлайна, включает навигацию

---

## Добавление маршрута

Чтобы добавить новый маршрут:

### 1. Подготовьте файл

Файл маршрута в формате **KML** или **KMZ** (Google Earth, Locus Map, OsmAnd и др.).

**Требования к файлу:**
- Формат: `.kml` или `.kmz`
- Должен содержать хотя бы один `LineString` (трек маршрута)
- Точки интереса (`Point`) — опционально, но полезно (привалы, магазины, достопримечательности)
- Имя файла: латиница, через дефисы, без пробелов. Например: `moscow-river-zvenigorod.kml`

**Описание маршрута** добавляется внутри KML в теге `<description>` элемента `<Document>`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>
    <name>Москва-река (Дорохово — Звенигород)</name>
    <description>
      Живописный маршрут вдоль Москвы-реки.
      Подробнее: https://example.com/route
    </description>
    <!-- Placemarks с LineString и Point -->
  </Document>
</kml>
```

Приложение автоматически извлечёт из файла:
- Название маршрута (`<name>`)
- Описание (`<description>`)
- Длину трека и размах (вычисляются из координат)
- Высоты, подъём, спуск (если указаны в описании)
- Точки интереса (POI)

### 2. Добавьте файл в репозиторий

**Вариант A — через веб-интерфейс GitHub (просто):**

1. Откройте папку [`routes/`](https://github.com/amchercashin/VeloTrek/tree/main/routes) в этом репозитории
2. Нажмите **Add file → Upload files**
3. Перетащите ваш KML/KMZ файл
4. Нажмите **Commit changes** (или **Propose changes** если у вас нет прав записи — создастся Pull Request)

**Вариант B — через git (для разработчиков):**

```bash
cp your-route.kml routes/
git add routes/your-route.kml
git commit -m "feat: добавить маршрут Название"
git push
```

### 3. Готово

После коммита GitHub Action автоматически:
- Распарсит ваш KML-файл
- Извлечёт название, статистику, координаты
- Обновит `routes/index.json`
- Маршрут появится в приложении

---

## Локальная разработка

```bash
# Клонировать
git clone https://github.com/amchercashin/VeloTrek.git
cd VeloTrek

# Запустить dev-сервер
python3 -m http.server 8080

# Открыть http://localhost:8080
```

Для регенерации каталога вручную:

```bash
python3 scripts/generate-index.py
```

## Лицензия

MIT
