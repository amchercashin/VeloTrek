<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta name="theme-color" content="#2D6A4F" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />
    <link rel="icon" href="icons/icon-192.png" />
    <title>ВелоТропа — Маршрут</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <header class="header">
      <div class="header__inner">
        <a href="index.html" class="header__back" aria-label="Назад">&larr;</a>
        <span class="header__title" id="header-title">Маршрут</span>
        <span></span>
      </div>
    </header>

    <!-- Загрузка -->
    <div class="loading" id="loading">
      <div class="loading__spinner"></div>
      <p>Загрузка маршрута...</p>
    </div>

    <!-- Ошибка -->
    <div class="error-msg hidden" id="error">
      <p class="error-msg__text"></p>
      <a href="index.html" class="error-msg__retry">Назад к каталогу</a>
    </div>

    <!-- Контент маршрута -->
    <div class="route-page hidden" id="route-content">
      <div class="route-info">
        <h1 class="route-info__name" id="route-name"></h1>
        <p class="route-info__desc" id="route-desc"></p>
        <div class="route-info__stats" id="route-stats"></div>
        <div class="offline-status-row">
          <div class="offline-indicator hidden" id="offline-indicator"></div>
          <button class="btn-clear-offline hidden" id="btn-clear-offline">
            Удалить
          </button>
        </div>
      </div>

      <div id="map"></div>

      <!-- Панель действий -->
      <div class="action-bar">
        <button class="btn btn--primary" id="btn-download">
          Скачать карту
        </button>
        <button class="btn btn--success" id="btn-gps">Навигация</button>
      </div>

      <!-- Прогресс скачивания -->
      <div class="download-panel hidden" id="download-panel">
        <p class="download-panel__status" id="download-status">Подготовка...</p>
        <div class="progress-bar">
          <div class="progress-bar__fill" id="progress-fill"></div>
        </div>
        <button
          class="btn btn--secondary"
          id="btn-cancel-download"
          style="margin-top: 4px"
        >
          Отмена
        </button>
      </div>

      <!-- GPS-панель -->
      <div class="gps-panel hidden" id="gps-panel">
        <div class="gps-panel__info">
          <div class="gps-panel__item">
            <span class="gps-panel__value" id="gps-speed">—</span>
            <span class="gps-panel__label">км/ч</span>
          </div>
          <div class="gps-panel__item">
            <span class="gps-panel__value" id="gps-distance">—</span>
            <span class="gps-panel__label">до маршрута</span>
          </div>
          <div class="gps-panel__item">
            <span class="gps-panel__value" id="gps-accuracy">—</span>
            <span class="gps-panel__label">точность</span>
          </div>
        </div>
        <button
          class="btn btn--secondary btn--center"
          id="btn-center"
          title="Центрировать на позиции"
        >
          <svg
            viewBox="0 0 24 24"
            width="18"
            height="18"
            fill="none"
            stroke="currentColor"
            stroke-width="2.2"
            stroke-linecap="round"
          >
            <circle cx="12" cy="12" r="6" />
            <circle cx="12" cy="12" r="1.5" fill="currentColor" stroke="none" />
            <line x1="12" y1="2" x2="12" y2="6" />
            <line x1="12" y1="18" x2="12" y2="22" />
            <line x1="2" y1="12" x2="6" y2="12" />
            <line x1="18" y1="12" x2="22" y2="12" />
          </svg>
        </button>
      </div>

      <!-- Описание маршрута -->
      <div class="route-description hidden" id="route-description"></div>
    </div>

    <!-- Библиотеки -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/idb@8/build/umd.js"></script>

    <!-- Приложение -->
    <script src="js/kml-parser.js"></script>
    <script src="js/app.js"></script>
    <script src="js/offline.js"></script>
    <script src="js/map.js"></script>
    <script src="js/gps.js"></script>
    <script src="js/route.js"></script>

    <script>
      SWUpdater.init();
    </script>
  </body>
</html>
